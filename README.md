# Pd_Geocache

Search geocaching databases for evidence of people visiting caves!

- Geocaching sites from areas of Canada and the US that are impacted by WNS.
- Sites from Central European Countries that may overlap with the (likely) EU Pd population that has since invaded North America.

![Average monthly visitors to geocache sites](workflow/figures/num-geocache-year.png)

## General Workflow

### Data Collection and Curation

- `snakemake` pipeline can handle the entire workflow:
- as input, an unfiltered list of geocache sites
  - list of sites generated by searching titles and descriptions of geocache sites using keywords
    - i.e. cave, mine, etc.
- Uses [`pycaching`](https://github.com/tomasbedrich/pycaching) `python` module to collect information from geocaching forum, uses GroundSpeak's API
  - pulls user info, visits to a site, date, log entry
  - aggregating records in a usable format
  - still issues with scraping, mostly due to "premium only" or non-standard cache types. The work around here is to use a geocache premium subscription

### Analysis

- showing temporal trends, etc.
- `geocache_mapping.R`

- reverse-lookup of users
  - `user_lookup.R`

### Incorporating spatial information

- Find which geocaching sites overlap with which counties
  - `coordinate-overlap.R`
- Find closest match to known sites by fuzzing matching of lat/lon
  - `coordinate-match.R`

### Incorporating WNS incidence records

- Grabbing WNS records
  - `wns-presence.R`
- raster/shape files of US/Canada counties
  - `county-fix.R`
- Adjacency matrix
  - `spatial-weight-matrix.R`

### Statistical tests

#### Does the spread of WNS correspond to the levels of human activity?

## Installation

### Prerequisites

- minimum `R` version of 4.04
- many dependencies are needed spatial operations in `R`!

1. build conda environment using yaml file
   - `conda env create -f env.yml`
2. run using `snakemake --use-conda ...`

## TO-DO

### Urgent

- [ ] snakemake workflow runs through both NA and EU collections

- [x] Be better at filtering out false-positive sites

  - [x] confirm accuracy of geocache locations -- Mines/Caves are actually in Mines/Caves
  - [x] try a few terms to exclude from site descriptions
    - [x] this involves changing scraping script to include description

- [ ] Additional improvements to filtering

  - [ ] use overlapping sites to validate filtering pipeline
  - [ ] fix buffering method for lon/lat data
  - [ ] create an index of matching polygons from presence data

- [ ] add a check to make sure that geographical positions of sites make sense

- [ ] Fixing animations

  - caused by updates to `gganimate`?
  - Specifically having trouble with `transition_states` on dates.

- [x] Adjacency matrix at the geocache level, instead of county
- [ ] Our county records for sim params
- [ ] Estimation of R0?

  - [ ] include bat population data (i.e. growth rate)
    - data from monitoring populations impacted by WNS for multiple years

- [ ] Proportion of shared visits for all possible edges (path)

- [ ] re-implement reverse `user-lookup.R`

### Not as urgent

- [ ] Smarter regex strategy for finding user records with bat sightings
  - i.e. "spotted a bat" vs. "blind as a bat"
- [ ] update README with statistical methods
- [ ] clean up data dir
