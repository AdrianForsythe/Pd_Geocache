###### snakemake pipeline to scrape geocaching records overlapping with likely sites of bat hibernacula ######
### Start with raw list
# Read in GC list

# Take a sample of the description sections from GC pages
# source("scripts/sample_descriptions.R"),
# sampled = sample.description(gc_dat),

# clean the list of GC sites based on sampling keywords from descriptions

rule SampleDescriptions:
    input:
        "data/gc-list-eu-unfiltered.csv"
    output:
        "data/gc-eu-descriptions.csv"
    script:
        "scripts/pycaching-descriptions.py"

rule FilterDescriptions:
    input:
        "data/gc-eu-descriptions.csv"
    output:
        "data/gc-list-eu-filtered.csv"
        #"figures/keyword-combinations-eu.png"
    script:
        "scripts/filter_eu_descriptions.R"

# Now scrape just the sites that have these keywords

rule ScrapeGC:
    input:
        "data/gc-list-eu-filtered.csv"
    output:
        "data/gc-eu-scrape.csv"
    script:
        "scripts/pycaching.py"

# Visualization of movement between sites
rule PlotMapping:
    input:
        "data/gc-eu-scrape.csv",
	"data/gc-scrape.csv"
    output:
        "figures/eu-num-geocache.png",
        "figures/eu-num-geocache-year.png",
        "figures/eu-max-visits-date.png",
        "figures/eu-travellers.gif"
    script:
        "scripts/eu_geocache_mapping.R"
